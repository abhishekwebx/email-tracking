(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92927,(e,t,a)=>{t.exports=e.r(10351)},93096,e=>{"use strict";var t=e.i(84576);let a=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:n="",children:o,iconNode:c,...d},u)=>(0,t.createElement)("svg",{ref:u,...s,width:r,height:r,stroke:e,strokeWidth:i?24*Number(l)/Number(r):l,className:a("lucide",n),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,a])=>(0,t.createElement)(e,a)),...Array.isArray(o)?o:[o]])),i=(e,s)=>{let i=(0,t.forwardRef)(({className:i,...n},o)=>(0,t.createElement)(l,{ref:o,iconNode:s,className:a(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,i),...n}));return i.displayName=r(e),i};e.s(["default",()=>i],93096)},56262,e=>{"use strict";var t=e.i(44589),a=e.i(92927),r=e.i(84576);function s({children:e}){let s=(0,a.useRouter)(),[l,i]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{localStorage.getItem("token")?i(!1):s.push("/login")},[s]),l)?(0,t.jsx)("p",{children:"Checking authentication..."}):(0,t.jsx)(t.Fragment,{children:e})}e.s(["default",()=>s])},19410,e=>{"use strict";var t=e.i(44589),a=e.i(84576),r=e.i(56262),s=e.i(92927),l=e.i(89775);function i({emailId:e}){let i,n=(0,s.useRouter)(),o=(0,s.useSearchParams)().get("template"),[c,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),[p,g]=(0,a.useState)(""),[j,x]=(0,a.useState)(""),[y,b]=(0,a.useState)(!1),[v,S]=(0,a.useState)(null),[w,N]=(0,a.useState)(!1),[k,C]=(0,a.useState)(e||null),[E,A]=(0,a.useState)([]),[T,$]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/templates?limit=50"),t=await e.json();A(Array.isArray(t.data)?t.data:[])}catch(e){console.error("Template load error",e)}})()},[]),(0,a.useEffect)(()=>{if(!o||!Array.isArray(E))return;let e=E.find(e=>e._id===o);e&&($(e._id),f(e.subject||""),g(e.body||""))},[o,E]),(0,a.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("user")||"{}");x(e?.email||"")},[]),(0,a.useEffect)(()=>{e&&(async()=>{try{let t=await fetch(`/api/emails/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await t.json();if(!t.ok)throw Error(a.error);d(a.to||[]),f(a.subject||""),g(a.body||""),x(a.senderName||""),C(a._id)}catch(e){console.error("Draft load error",e)}})()},[e]);let _=()=>c.length>0&&""!==h.trim()&&""!==p.trim(),O=async()=>{b(!0),S(null);try{let e=await fetch("/api/draft",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({id:k,senderName:j,to:c,subject:h,body:p})}),t=await e.json();if(!e.ok)throw Error(t.error);C(t._id),n.push("/crm/draft-mail")}catch(e){S(e.message||"Failed to save draft")}finally{b(!1)}},B=async()=>{if(!_())return void S("All fields are required");b(!0),S(null);try{let e=await fetch("/api/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({id:k,to:c,subject:h,body:p,senderName:j})}),t=await e.json();if(!e.ok)throw Error(t.error);N(!0),d([]),f(""),g(""),C(null)}catch(e){S(e.message||"Failed to send email")}finally{b(!1)}};return(0,t.jsx)(r.default,{children:(0,t.jsx)("div",{className:"container",children:(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h1",{children:"Send Email"}),(0,t.jsx)("p",{className:"subtitle",children:"Track opens in real-time"}),v&&(0,t.jsx)("div",{className:"error",children:v}),w&&(0,t.jsx)("div",{className:"success",children:"Email sent successfully!"}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Select Template"}),(0,t.jsxs)("select",{value:T,onChange:e=>{var t;let a;return $(t=e.target.value),void((a=E.find(e=>e._id===t))&&(f(a.subject||""),g(a.body||"")))},className:"w-full border rounded-xl px-4 py-3",children:[(0,t.jsx)("option",{value:"",children:"Choose Template"}),Array.isArray(E)&&E.map(e=>(0,t.jsxs)("option",{value:e._id,children:[e.title,e.category?` (${e.category})`:""]},e._id))]}),T&&(0,t.jsx)("div",{className:"mt-4 border rounded-xl p-4 bg-indigo-50",children:(i=E.find(e=>e._id===T))?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"font-semibold text-indigo-700",children:i.title}),(0,t.jsx)("p",{className:"text-sm mt-2",children:i.subject})]}):null})]}),(0,t.jsx)("label",{children:"To"}),(0,t.jsxs)("div",{className:"email-wrapper",children:[c.map(e=>(0,t.jsxs)("span",{className:"chip",children:[e,(0,t.jsx)("button",{onClick:()=>{d(c.filter(t=>t!==e))},children:"Ã—"})]},e)),(0,t.jsx)("input",{type:"email",placeholder:"Type email & press Enter",value:u,onChange:e=>m(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&u.trim()){var t;let a;e.preventDefault(),(a=t=(t=u).trim(),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))?(c.includes(t)||d([t,...c]),m(""),S(null)):S("Invalid email format")}},onPaste:e=>{e.clipboardData.getData("text").split(/[,;\s]+/).forEach(e=>{/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&!c.includes(e)&&d(t=>[e,...t])}),e.preventDefault()}})]}),(0,t.jsx)("label",{children:"Subject"}),(0,t.jsx)("input",{value:h,onChange:e=>f(e.target.value)}),(0,t.jsx)("label",{children:"Message"}),(0,t.jsx)(l.default,{body:p,setBody:g}),(0,t.jsx)("button",{className:"send-button ml-2",onClick:O,disabled:y,children:y?"Saving...":"Save Email as Draft"}),(0,t.jsx)("button",{className:"send-button",onClick:B,disabled:!_(),children:y?"Sending...":"Send Email"})]})})})}e.s(["default",()=>i])},24784,e=>{"use strict";var t=e.i(44589),a=e.i(19410);function r({params:e}){return(0,t.jsx)(a.default,{emailId:e.id})}e.s(["default",()=>r])}]);