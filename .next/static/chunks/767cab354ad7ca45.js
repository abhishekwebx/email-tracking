(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19410,e=>{"use strict";var t=e.i(44589),a=e.i(84576),s=e.i(56262),r=e.i(92927),l=e.i(89775);function i({emailId:e}){let i,n=(0,r.useRouter)(),d=(0,r.useSearchParams)().get("template"),[o,c]=(0,a.useState)([]),[u,m]=(0,a.useState)(""),[h,x]=(0,a.useState)(""),[p,f]=(0,a.useState)(""),[j,g]=(0,a.useState)(""),[y,b]=(0,a.useState)(!1),[v,N]=(0,a.useState)(null),[S,k]=(0,a.useState)(!1),[C,w]=(0,a.useState)(e||null),[E,A]=(0,a.useState)([]),[T,P]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/templates?limit=50"),t=await e.json();A(Array.isArray(t.data)?t.data:[])}catch(e){console.error("Template load error",e)}})()},[]),(0,a.useEffect)(()=>{if(!d||!Array.isArray(E))return;let e=E.find(e=>e._id===d);e&&(P(e._id),x(e.subject||""),f(e.body||""))},[d,E]),(0,a.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("user")||"{}");g(e?.email||"")},[]),(0,a.useEffect)(()=>{e&&(async()=>{try{let t=await fetch(`/api/emails/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await t.json();if(!t.ok)throw Error(a.error);c(a.to||[]),x(a.subject||""),f(a.body||""),g(a.senderName||""),w(a._id)}catch(e){console.error("Draft load error",e)}})()},[e]);let $=()=>o.length>0&&""!==h.trim()&&""!==p.trim(),D=async()=>{b(!0),N(null);try{let e=await fetch("/api/draft",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({id:C,senderName:j,to:o,subject:h,body:p})}),t=await e.json();if(!e.ok)throw Error(t.error);w(t._id),n.push("/crm/draft-mail")}catch(e){N(e.message||"Failed to save draft")}finally{b(!1)}},I=async()=>{if(!$())return void N("All fields are required");b(!0),N(null);try{let e=await fetch("/api/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({id:C,to:o,subject:h,body:p,senderName:j})}),t=await e.json();if(!e.ok)throw Error(t.error);k(!0),c([]),x(""),f(""),w(null)}catch(e){N(e.message||"Failed to send email")}finally{b(!1)}};return(0,t.jsx)(s.default,{children:(0,t.jsx)("div",{className:"container",children:(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h1",{children:"Send Email"}),(0,t.jsx)("p",{className:"subtitle",children:"Track opens in real-time"}),v&&(0,t.jsx)("div",{className:"error",children:v}),S&&(0,t.jsx)("div",{className:"success",children:"Email sent successfully!"}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Select Template"}),(0,t.jsxs)("select",{value:T,onChange:e=>{var t;let a;return P(t=e.target.value),void((a=E.find(e=>e._id===t))&&(x(a.subject||""),f(a.body||"")))},className:"w-full border rounded-xl px-4 py-3",children:[(0,t.jsx)("option",{value:"",children:"Choose Template"}),Array.isArray(E)&&E.map(e=>(0,t.jsxs)("option",{value:e._id,children:[e.title,e.category?` (${e.category})`:""]},e._id))]}),T&&(0,t.jsx)("div",{className:"mt-4 border rounded-xl p-4 bg-indigo-50",children:(i=E.find(e=>e._id===T))?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"font-semibold text-indigo-700",children:i.title}),(0,t.jsx)("p",{className:"text-sm mt-2",children:i.subject})]}):null})]}),(0,t.jsx)("label",{children:"To"}),(0,t.jsxs)("div",{className:"email-wrapper",children:[o.map(e=>(0,t.jsxs)("span",{className:"chip",children:[e,(0,t.jsx)("button",{onClick:()=>{c(o.filter(t=>t!==e))},children:"Ã—"})]},e)),(0,t.jsx)("input",{type:"email",placeholder:"Type email & press Enter",value:u,onChange:e=>m(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&u.trim()){var t;let a;e.preventDefault(),(a=t=(t=u).trim(),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))?(o.includes(t)||c([t,...o]),m(""),N(null)):N("Invalid email format")}},onPaste:e=>{e.clipboardData.getData("text").split(/[,;\s]+/).forEach(e=>{/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&!o.includes(e)&&c(t=>[e,...t])}),e.preventDefault()}})]}),(0,t.jsx)("label",{children:"Subject"}),(0,t.jsx)("input",{value:h,onChange:e=>x(e.target.value)}),(0,t.jsx)("label",{children:"Message"}),(0,t.jsx)(l.default,{body:p,setBody:f}),(0,t.jsx)("button",{className:"send-button ml-2",onClick:D,disabled:y,children:y?"Saving...":"Save Email as Draft"}),(0,t.jsx)("button",{className:"send-button",onClick:I,disabled:!$(),children:y?"Sending...":"Send Email"})]})})})}e.s(["default",()=>i])},98663,e=>{"use strict";let t=(0,e.i(93096).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],98663)},35080,45113,e=>{"use strict";var t=e.i(44589),a=e.i(68802);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>r],35080);let l=(0,e.i(93096).default)("mouse-pointer-click",[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]]);e.s(["MousePointerClick",()=>l],45113)},16515,e=>{"use strict";var t=e.i(44589),a=e.i(84576),s=e.i(92927),r=e.i(56262),l=e.i(35080),i=e.i(98663),n=e.i(45113);let d=(0,e.i(93096).default)("mail-check",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]);function o(){let{id:e}=(0,s.useParams)(),[o,m]=(0,a.useState)(null),[h,x]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let t=async()=>{let t=await fetch(`/api/emails/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});m(await t.json()),x(!1)};e&&t()},[e]),h)?(0,t.jsx)("div",{className:"flex h-[60vh] items-center justify-center text-xl font-semibold text-muted-foreground",children:"Loading Email..."}):o?(0,t.jsx)(r.default,{children:(0,t.jsxs)("main",{className:"p-6 md:p-10 max-w-6xl mx-auto space-y-8",children:[(0,t.jsxs)("header",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Email Details"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Complete activity and message preview"})]}),(0,t.jsxs)("section",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,t.jsx)(u,{title:"Open Count",value:o.openCount,icon:(0,t.jsx)(i.Eye,{}),gradient:"from-green-500 to-emerald-500"}),(0,t.jsx)(u,{title:"Click Count",value:o.clickCount,icon:(0,t.jsx)(n.MousePointerClick,{}),gradient:"from-pink-500 to-rose-500"}),(0,t.jsx)(u,{title:"Delivery",value:"Sent",icon:(0,t.jsx)(d,{}),gradient:"from-blue-500 to-indigo-500"})]}),(0,t.jsx)(l.Card,{className:"rounded-2xl shadow-sm",children:(0,t.jsx)(l.CardContent,{className:"p-6 space-y-3",children:(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsx)(c,{label:"Recipient",value:o.to}),(0,t.jsx)(c,{label:"Subject",value:o.subject}),(0,t.jsx)(c,{label:"Sent At",value:new Date(o.sentAt).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground text-xs",children:"Status"}),(0,t.jsx)("span",{className:`inline-block mt-1 px-3 py-1 rounded-full text-xs font-semibold ${o.opened?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"}`,children:o.opened?"Opened":"Pending"})]})]})})}),(0,t.jsx)(l.Card,{className:"rounded-2xl shadow-sm",children:(0,t.jsxs)(l.CardContent,{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Email Preview"}),(0,t.jsx)("div",{className:"border rounded-xl p-5 bg-muted/30 prose max-w-none",children:(0,t.jsx)("div",{className:"email-body",dangerouslySetInnerHTML:{__html:o.body}})})]})})]})}):(0,t.jsx)("p",{children:"Email not found"})}function c({label:e,value:a}){return(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground text-xs",style:{marginBottom:"5px"},children:e}),(0,t.jsx)("p",{className:"font-medium",children:a})]})}function u({title:e,value:a,icon:s,gradient:r}){return(0,t.jsx)(l.Card,{className:"rounded-2xl shadow-sm hover:shadow-md transition",children:(0,t.jsxs)(l.CardContent,{className:"p-6 flex items-center gap-4",children:[(0,t.jsx)("div",{className:`p-3 rounded-xl text-white bg-gradient-to-br ${r}`,children:s}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:a})]})]})})}e.s(["default",()=>o],16515)},96246,e=>{"use strict";var t=e.i(44589),a=e.i(56262),s=e.i(92927),r=e.i(19410),l=e.i(16515);function i(){let e=(0,s.useParams)(),i=sessionStorage.getItem("route");return(0,t.jsxs)(a.default,{children:["/crm/dashboard"!==i&&(0,t.jsx)(r.default,{emailId:e?.id}),"/crm/dashboard"===i&&(0,t.jsx)(l.default,{})]})}e.s(["default",()=>i])}]);