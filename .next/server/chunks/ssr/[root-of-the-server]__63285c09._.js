module.exports=[70454,(a,b,c)=>{"use strict";b.exports=a.r(55470).vendored.contexts.AppRouterContext},65253,(a,b,c)=>{"use strict";b.exports=a.r(55470).vendored.contexts.HooksClientContext},5815,(a,b,c)=>{"use strict";b.exports=a.r(55470).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},55470,(a,b,c)=>{"use strict";b.exports=a.r(18622)},21695,(a,b,c)=>{"use strict";b.exports=a.r(55470).vendored["react-ssr"].ReactJsxRuntime},18599,(a,b,c)=>{"use strict";b.exports=a.r(55470).vendored["react-ssr"].React},55554,(a,b,c)=>{"use strict";b.exports=a.r(55470).vendored["react-ssr"].ReactDOM},9152,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},43695,a=>{"use strict";var b=a.i(18599);let c=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim(),d=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)};var e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,b.forwardRef)(({color:a="currentColor",size:d=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...e,width:d,height:d,stroke:a,strokeWidth:g?24*Number(f)/Number(d):f,className:c("lucide",h),...!i&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0;return!1})(k)&&{"aria-hidden":"true"},...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),g=(a,e)=>{let g=(0,b.forwardRef)(({className:g,...h},i)=>(0,b.createElement)(f,{ref:i,iconNode:e,className:c(`lucide-${d(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,g),...h}));return g.displayName=d(a),g};a.s(["default",()=>g],43695)},70282,a=>{"use strict";var b=a.i(21695),c=a.i(51835),d=a.i(18599);function e({children:a}){let e=(0,c.useRouter)(),[f,g]=(0,d.useState)(!0);return((0,d.useEffect)(()=>{localStorage.getItem("token")?g(!1):e.push("/login")},[e]),f)?(0,b.jsx)("p",{children:"Checking authentication..."}):(0,b.jsx)(b.Fragment,{children:a})}a.s(["default",()=>e])},46528,a=>{"use strict";var b=a.i(21695),c=a.i(18599),d=a.i(70282),e=a.i(51835),f=a.i(86123);function g({emailId:a}){let g,h=(0,e.useRouter)(),i=(0,e.useSearchParams)().get("template"),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(a||null),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)("");(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/templates?limit=50"),b=await a.json();C(Array.isArray(b.data)?b.data:[])}catch(a){console.error("Template load error",a)}})()},[]),(0,c.useEffect)(()=>{if(!i||!Array.isArray(B))return;let a=B.find(a=>a._id===i);a&&(E(a._id),o(a.subject||""),q(a.body||""))},[i,B]),(0,c.useEffect)(()=>{let a=JSON.parse(localStorage.getItem("user")||"{}");s(a?.email||"")},[]),(0,c.useEffect)(()=>{a&&(async()=>{try{let b=await fetch(`/api/emails/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),c=await b.json();if(!b.ok)throw Error(c.error);k(c.to||[]),o(c.subject||""),q(c.body||""),s(c.senderName||""),A(c._id)}catch(a){console.error("Draft load error",a)}})()},[a]);let F=()=>j.length>0&&""!==n.trim()&&""!==p.trim(),G=async()=>{u(!0),w(null);try{let a=await fetch("/api/draft",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({id:z,senderName:r,to:j,subject:n,body:p})}),b=await a.json();if(!a.ok)throw Error(b.error);A(b._id),h.push("/crm/draft-mail")}catch(a){w(a.message||"Failed to save draft")}finally{u(!1)}},H=async()=>{if(!F())return void w("All fields are required");u(!0),w(null);try{let a=await fetch("/api/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({id:z,to:j,subject:n,body:p,senderName:r})}),b=await a.json();if(!a.ok)throw Error(b.error);y(!0),k([]),o(""),q(""),A(null)}catch(a){w(a.message||"Failed to send email")}finally{u(!1)}};return(0,b.jsx)(d.default,{children:(0,b.jsx)("div",{className:"container",children:(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h1",{children:"Send Email"}),(0,b.jsx)("p",{className:"subtitle",children:"Track opens in real-time"}),v&&(0,b.jsx)("div",{className:"error",children:v}),x&&(0,b.jsx)("div",{className:"success",children:"Email sent successfully!"}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2",children:"Select Template"}),(0,b.jsxs)("select",{value:D,onChange:a=>{var b;let c;return E(b=a.target.value),void((c=B.find(a=>a._id===b))&&(o(c.subject||""),q(c.body||"")))},className:"w-full border rounded-xl px-4 py-3",children:[(0,b.jsx)("option",{value:"",children:"Choose Template"}),Array.isArray(B)&&B.map(a=>(0,b.jsxs)("option",{value:a._id,children:[a.title,a.category?` (${a.category})`:""]},a._id))]}),D&&(0,b.jsx)("div",{className:"mt-4 border rounded-xl p-4 bg-indigo-50",children:(g=B.find(a=>a._id===D))?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h3",{className:"font-semibold text-indigo-700",children:g.title}),(0,b.jsx)("p",{className:"text-sm mt-2",children:g.subject})]}):null})]}),(0,b.jsx)("label",{children:"To"}),(0,b.jsxs)("div",{className:"email-wrapper",children:[j.map(a=>(0,b.jsxs)("span",{className:"chip",children:[a,(0,b.jsx)("button",{onClick:()=>{k(j.filter(b=>b!==a))},children:"Ã—"})]},a)),(0,b.jsx)("input",{type:"email",placeholder:"Type email & press Enter",value:l,onChange:a=>m(a.target.value),onKeyDown:a=>{if("Enter"===a.key&&l.trim()){var b;let c;a.preventDefault(),(c=b=(b=l).trim(),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c))?(j.includes(b)||k([b,...j]),m(""),w(null)):w("Invalid email format")}},onPaste:a=>{a.clipboardData.getData("text").split(/[,;\s]+/).forEach(a=>{/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)&&!j.includes(a)&&k(b=>[a,...b])}),a.preventDefault()}})]}),(0,b.jsx)("label",{children:"Subject"}),(0,b.jsx)("input",{value:n,onChange:a=>o(a.target.value)}),(0,b.jsx)("label",{children:"Message"}),(0,b.jsx)(f.default,{body:p,setBody:q}),(0,b.jsx)("button",{className:"send-button ml-2",onClick:G,disabled:t,children:t?"Saving...":"Save Email as Draft"}),(0,b.jsx)("button",{className:"send-button",onClick:H,disabled:!F(),children:t?"Sending...":"Send Email"})]})})})}a.s(["default",()=>g])},77860,a=>{"use strict";var b=a.i(21695),c=a.i(46528);function d({params:a}){return(0,b.jsx)(c.default,{emailId:a.id})}a.s(["default",()=>d])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__63285c09._.js.map