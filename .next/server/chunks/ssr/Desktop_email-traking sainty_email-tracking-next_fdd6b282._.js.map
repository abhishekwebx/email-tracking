{"version":3,"sources":["../../../../../../../Desktop/email-traking%20sainty/email-tracking-next/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-dom.ts","../../../../../../../Desktop/email-traking%20sainty/email-tracking-next/app/crm/send/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactDOM\n","\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport \"./send-email.css\";\nimport AuthGuard from \"@/components/AuthGuard\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport SimpleEmailEditor from \"./emailEditor\";\n\ninterface SendEmailProps {\n  emailId?: string;\n}\n\nexport default function SendEmail({ emailId }: SendEmailProps) {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n\n  const templateFromUrl = searchParams.get(\"template\");\n\n  const [to, setTo] = useState<string[]>([]);\n  const [inputValue, setInputValue] = useState(\"\");\n\n  const [subject, setSubject] = useState(\"\");\n  const [body, setBody] = useState(\"\");\n  const [senderName, setSenderName] = useState(\"\");\n\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n\n  const [draftId, setDraftId] = useState<string | null>(emailId || null);\n  const [templates, setTemplates] = useState<any[]>([]);\n  const [selectedTemplate, setSelectedTemplate] = useState(\"\");\n\n  /* ---------------------------------------------------\n     LOAD TEMPLATES\n  --------------------------------------------------- */\n\n  useEffect(() => {\n    const loadTemplates = async () => {\n      try {\n        const res = await fetch(\"/api/templates?limit=50\");\n        const data = await res.json();\n\n        setTemplates(Array.isArray(data.data) ? data.data : []);\n      } catch (err) {\n        console.error(\"Template load error\", err);\n      }\n    };\n\n    loadTemplates();\n  }, []);\n\n  /* ---------------------------------------------------\n     AUTO LOAD TEMPLATE FROM URL\n  --------------------------------------------------- */\n\n  useEffect(() => {\n    if (!templateFromUrl) return;\n    if (!Array.isArray(templates)) return;\n\n    const template = templates.find(\n      (t) => t._id === templateFromUrl\n    );\n\n    if (template) {\n      setSelectedTemplate(template._id);\n      setSubject(template.subject || \"\");\n      setBody(template.body || \"\");\n    }\n  }, [templateFromUrl, templates]);\n\n  /* ---------------------------------------------------\n     TEMPLATE SELECT HANDLER\n  --------------------------------------------------- */\n\n  const handleTemplateSelect = (templateId: string) => {\n    setSelectedTemplate(templateId);\n\n    const template = templates.find((t) => t._id === templateId);\n\n    if (template) {\n      setSubject(template.subject || \"\");\n      setBody(template.body || \"\");\n    }\n  };\n\n  /* ---------------------------------------------------\n     LOAD USER\n  --------------------------------------------------- */\n\n  useEffect(() => {\n    const user = JSON.parse(localStorage.getItem(\"user\") || \"{}\");\n    setSenderName(user?.email || \"\");\n  }, []);\n\n  /* ---------------------------------------------------\n     LOAD DRAFT\n  --------------------------------------------------- */\n\n  useEffect(() => {\n    if (!emailId) return;\n\n    const loadDraft = async () => {\n      try {\n        const res = await fetch(`/api/emails/${emailId}`, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n          },\n        });\n\n        const data = await res.json();\n        if (!res.ok) throw new Error(data.error);\n\n        setTo(data.to || []);\n        setSubject(data.subject || \"\");\n        setBody(data.body || \"\");\n        setSenderName(data.senderName || \"\");\n        setDraftId(data._id);\n      } catch (err) {\n        console.error(\"Draft load error\", err);\n      }\n    };\n\n    loadDraft();\n  }, [emailId]);\n\n  /* ---------------------------------------------------\n     EMAIL HANDLING\n  --------------------------------------------------- */\n\n  const isValidEmail = (email: string) =>\n    /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n\n  const addEmail = (email: string) => {\n    email = email.trim();\n\n    if (!isValidEmail(email)) {\n      setError(\"Invalid email format\");\n      return;\n    }\n\n    if (!to.includes(email)) {\n      setTo([email, ...to]);\n    }\n\n    setInputValue(\"\");\n    setError(null);\n  };\n\n  const removeEmail = (email: string) => {\n    setTo(to.filter((e) => e !== email));\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && inputValue.trim()) {\n      e.preventDefault();\n      addEmail(inputValue);\n    }\n  };\n\n  const handlePaste = (e: React.ClipboardEvent<HTMLInputElement>) => {\n    const paste = e.clipboardData.getData(\"text\");\n    const emails = paste.split(/[,;\\s]+/);\n\n    emails.forEach((email) => {\n      if (isValidEmail(email) && !to.includes(email)) {\n        setTo((prev) => [email, ...prev]);\n      }\n    });\n\n    e.preventDefault();\n  };\n\n  const isFormValid = () =>\n    to.length > 0 && subject.trim() !== \"\" && body.trim() !== \"\";\n\n  /* ---------------------------------------------------\n     SAVE DRAFT\n  --------------------------------------------------- */\n\n  const saveAsDraft = async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const res = await fetch(\"/api/draft\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n        body: JSON.stringify({\n          id: draftId,\n          senderName,\n          to,\n          subject,\n          body,\n        }),\n      });\n\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error);\n\n      setDraftId(data._id);\n      router.push(\"/crm/draft-mail\");\n    } catch (err: any) {\n      setError(err.message || \"Failed to save draft\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /* ---------------------------------------------------\n     SEND EMAIL\n  --------------------------------------------------- */\n\n  const sendEmail = async () => {\n    if (!isFormValid()) {\n      setError(\"All fields are required\");\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const res = await fetch(\"/api/send\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n        body: JSON.stringify({\n          id: draftId,\n          to,\n          subject,\n          body,\n          senderName,\n        }),\n      });\n\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error);\n\n      setSuccess(true);\n      setTo([]);\n      setSubject(\"\");\n      setBody(\"\");\n      setDraftId(null);\n    } catch (err: any) {\n      setError(err.message || \"Failed to send email\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /* ---------------------------------------------------\n     UI\n  --------------------------------------------------- */\n\n  return (\n    <AuthGuard>\n      <div className=\"container\">\n        <div className=\"card\">\n          <h1>Send Email</h1>\n          <p className=\"subtitle\">Track opens in real-time</p>\n\n          {error && <div className=\"error\">{error}</div>}\n          {success && (\n            <div className=\"success\">Email sent successfully!</div>\n          )}\n\n          {/* TEMPLATE SELECTOR */}\n          <div className=\"mb-6\">\n            <label className=\"block text-sm font-semibold mb-2\">\n              Select Template\n            </label>\n\n            <select\n              value={selectedTemplate}\n              onChange={(e) => handleTemplateSelect(e.target.value)}\n              className=\"w-full border rounded-xl px-4 py-3\"\n            >\n              <option value=\"\">Choose Template</option>\n\n              {Array.isArray(templates) &&\n                templates.map((template) => (\n                  <option key={template._id} value={template._id}>\n                    {template.title}\n                    {template.category\n                      ? ` (${template.category})`\n                      : \"\"}\n                  </option>\n                ))}\n            </select>\n\n            {/* Template Preview */}\n            {selectedTemplate && (\n              <div className=\"mt-4 border rounded-xl p-4 bg-indigo-50\">\n                {(() => {\n                  const template = templates.find(\n                    (t) => t._id === selectedTemplate\n                  );\n\n                  if (!template) return null;\n\n                  return (\n                    <>\n                      <h3 className=\"font-semibold text-indigo-700\">\n                        {template.title}\n                      </h3>\n                      <p className=\"text-sm mt-2\">\n                        {template.subject}\n                      </p>\n                    </>\n                  );\n                })()}\n              </div>\n            )}\n          </div>\n\n          {/* TO */}\n          <label>To</label>\n          <div className=\"email-wrapper\">\n            {to.map((email) => (\n              <span key={email} className=\"chip\">\n                {email}\n                <button onClick={() => removeEmail(email)}>Ã—</button>\n              </span>\n            ))}\n\n            <input\n              type=\"email\"\n              placeholder=\"Type email & press Enter\"\n              value={inputValue}\n              onChange={(e) => setInputValue(e.target.value)}\n              onKeyDown={handleKeyDown}\n              onPaste={handlePaste}\n            />\n          </div>\n\n          {/* SUBJECT */}\n          <label>Subject</label>\n          <input\n            value={subject}\n            onChange={(e) => setSubject(e.target.value)}\n          />\n\n          {/* MESSAGE */}\n          <label>Message</label>\n          <SimpleEmailEditor body={body} setBody={setBody} />\n\n          {/* BUTTONS */}\n          <button\n            className=\"send-button ml-2\"\n            onClick={saveAsDraft}\n            disabled={loading}\n          >\n            {loading ? \"Saving...\" : \"Save Email as Draft\"}\n          </button>\n\n          <button\n            className=\"send-button\"\n            onClick={sendEmail}\n            disabled={!isFormValid()}\n          >\n            {loading ? \"Sending...\" : \"Send Email\"}\n          </button>\n        </div>\n      </div>\n    </AuthGuard>\n  );\n}\n"],"names":["module","exports","require","vendored","ReactDOM"],"mappings":"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","ignoreList":[0]}