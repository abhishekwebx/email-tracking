{"version":3,"sources":["../../../../../../../Desktop/email-traking%20sainty/email-tracking-next/app/crm/templates/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport Swal from \"sweetalert2\";\n\nexport default function TemplatesList() {\n  const [templates, setTemplates] = useState<any[]>([]);\n  const [search, setSearch] = useState(\"\");\n  const [page, setPage] = useState(1);\n  const [total, setTotal] = useState(0);\n\n  const limit = 9;\n  const router = useRouter();\n\n  /* --------------------------------------------\n     LOAD TEMPLATES\n  -------------------------------------------- */\n  const loadTemplates = async () => {\n    try {\n      const res = await fetch(\n        `/api/templates?search=${search}&page=${page}&limit=${limit}`\n      );\n\n      const data = await res.json();\n\n      // âœ… FIXED RESPONSE KEY\n      setTemplates(Array.isArray(data.data) ? data.data : []);\n      setTotal(data.total || 0);\n\n    } catch (err) {\n      console.error(\"Template load error\", err);\n      setTemplates([]);\n    }\n  };\n\n  useEffect(() => {\n    loadTemplates();\n  }, [search, page]);\n\n  /* --------------------------------------------\n     DELETE TEMPLATE\n  -------------------------------------------- */\n  const deleteTemplate = async (id: string) => {\n    const result = await Swal.fire({\n      title: \"Delete Template?\",\n      text: \"This action cannot be undone.\",\n      icon: \"warning\",\n      showCancelButton: true,\n      confirmButtonColor: \"#d33\",\n      cancelButtonColor: \"#3085d6\",\n      confirmButtonText: \"Yes, delete it!\",\n    });\n\n    if (!result.isConfirmed) return;\n\n    try {\n      await fetch(`/api/templates/${id}`, {\n        method: \"DELETE\",\n      });\n\n      setTemplates((prev) => prev.filter((t) => t._id !== id));\n\n      Swal.fire(\"Deleted!\", \"Template deleted.\", \"success\");\n\n    } catch {\n      Swal.fire(\"Error\", \"Failed to delete template\", \"error\");\n    }\n  };\n\n  const totalPages = Math.ceil(total / limit);\n\n  /* --------------------------------------------\n     UI\n  -------------------------------------------- */\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n\n        {/* Header */}\n        <div className=\"flex justify-between items-center mb-6\">\n          <h1 className=\"text-2xl font-semibold text-gray-800\">\n            Email Templates\n          </h1>\n\n          <button\n            onClick={() => router.push(\"/crm/templates/create\")}\n            className=\"bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 cursor-pointer\"\n          >\n            + Create Template\n          </button>\n        </div>\n\n        {/* Search */}\n        <div className=\"mb-6\">\n          <input\n            type=\"text\"\n            placeholder=\"Search templates...\"\n            value={search}\n            onChange={(e) => {\n              setSearch(e.target.value);\n              setPage(1);\n            }}\n            className=\"w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        {/* Template Grid */}\n        {templates.length === 0 ? (\n          <div className=\"bg-white p-10 rounded-xl shadow text-center\">\n            No templates found\n          </div>\n        ) : (\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {templates.map((t) => (\n              <div\n                key={t._id}\n                className=\"bg-indigo-50 rounded-xl shadow p-5 flex flex-col justify-between\"\n              >\n                <div>\n                  <h2 className=\"text-lg font-semibold text-indigo-700 mb-2\">\n                    {t.title}\n                  </h2>\n\n                  {t.category && (\n                    <span className=\"bg-blue-100 text-blue-700 text-xs px-3 py-1 rounded-full mb-3 inline-block\">\n                      {t.category}\n                    </span>\n                  )}\n\n                  <p className=\"text-sm text-gray-500 line-clamp-2\">\n                    {t.subject || \"No subject\"}\n                  </p>\n                </div>\n\n                {/* Actions */}\n                <div className=\"flex justify-between items-center mt-5\">\n\n                  <div className=\"flex gap-3\">\n                    <button\n                      onClick={() =>\n                        router.push(`/crm/templates/create?id=${t._id}`)\n                      }\n                      className=\"text-sm text-blue-600 border border-blue-600 px-3 py-1 rounded hover:bg-blue-600 hover:text-white transition cursor-pointer\"\n                    >\n                      Edit\n                    </button>\n\n                    <button\n                      onClick={() => deleteTemplate(t._id)}\n                      className=\"text-sm text-red-600 border border-red-600 px-3 py-1 rounded hover:bg-red-600 hover:text-white transition cursor-pointer\"\n                    >\n                      Delete\n                    </button>\n                  </div>\n\n                  <button\n                    onClick={() =>\n                      router.push(`/crm/send?template=${t._id}`)\n                    }\n                    className=\"bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-sm cursor-pointer\"\n                  >\n                    Use In\n                  </button>\n\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"flex justify-center mt-8 gap-4\">\n\n            <button\n              disabled={page === 1}\n              onClick={() => setPage(page - 1)}\n              className=\"px-4 py-2 border rounded disabled:opacity-40\"\n            >\n              Prev\n            </button>\n\n            <span className=\"px-4 py-2\">\n              Page {page} of {totalPages}\n            </span>\n\n            <button\n              disabled={page === totalPages}\n              onClick={() => setPage(page + 1)}\n              className=\"px-4 py-2 border rounded disabled:opacity-40\"\n            >\n              Next\n            </button>\n\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,GAAM,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAgB,EAAE,EAC9C,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC/B,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,GAC3B,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,GAG7B,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAKlB,EAAgB,UACpB,GAAI,CACF,IAAM,EAAM,MAAM,MAChB,CAAC,sBAAsB,EAAE,OAAO,GAAQ,GAAF,EAAO,MAAgB,CAAT,CAGhD,CAHkD,CAG3C,MAAM,EAAI,IAAI,GAG3B,EAAa,MAAM,OAAO,CAAC,EAAK,IAAI,EAAI,EAAK,IAAI,CAAG,EAAE,EACtD,EAAS,EAAK,KAAK,EAAI,EAEzB,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,sBAAuB,GACrC,EAAa,EAAE,CACjB,CACF,EAEA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,GACF,EAAG,CAAC,EAAQ,EAAK,EAKjB,IAAM,EAAiB,MAAO,IAW5B,GAAK,CAVU,AAUX,MAViB,EAAA,OAAI,CAAC,IAAI,CAAC,CAC7B,MAAO,mBACP,KAAM,gCACN,KAAM,UACN,iBAAkB,GAClB,mBAAoB,OACpB,kBAAmB,UACnB,kBAAmB,iBACrB,EAAA,EAEY,WAAW,CAEvB,CAFyB,EAErB,CACF,MAAM,MAAM,CAAC,eAAe,EAAE,EAAA,CAAI,CAAE,CAClC,OAAQ,QACV,GAEA,EAAa,AAAC,GAAS,EAAK,MAAM,CAAC,AAAC,GAAM,EAAE,GAAG,GAAK,IAEpD,EAAA,OAAI,CAAC,IAAI,CAAC,WAAY,oBAAqB,UAE7C,CAAE,KAAM,CACN,EAAA,OAAI,CAAC,IAAI,CAAC,QAAS,4BAA6B,QAClD,CACF,EAEM,EAAa,KAAK,IAAI,CAAC,EA1Df,GAgEd,GANqC,GAOnC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8BAGb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gDAAuC,oBAIrD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IAAM,EAAO,IAAI,CAAC,yBAC3B,UAAU,wFACX,yBAMH,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,OACL,YAAY,sBACZ,MAAO,EACP,SAAU,AAAC,IACT,EAAU,EAAE,MAAM,CAAC,KAAK,EACxB,EAAQ,EACV,EACA,UAAU,0EAKQ,IAArB,EAAU,MAAM,CACf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uDAA8C,uBAI7D,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oDACZ,EAAU,GAAG,CAAC,AAAC,GACd,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAEC,UAAU,6EAEV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,sDACX,EAAE,KAAK,GAGT,EAAE,QAAQ,EACT,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,sFACb,EAAE,QAAQ,GAIf,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8CACV,EAAE,OAAO,EAAI,kBAKlB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDAEb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IACP,EAAO,IAAI,CAAC,CAAC,yBAAyB,EAAE,EAAE,GAAG,CAAA,CAAE,EAEjD,UAAU,uIACX,SAID,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IAAM,EAAe,EAAE,GAAG,EACnC,UAAU,oIACX,cAKH,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IACP,EAAO,IAAI,CAAC,CAAC,mBAAmB,EAAE,EAAE,GAAG,CAAA,CAAE,EAE3C,UAAU,kFACX,gBA7CE,EAAE,GAAG,KAwDjB,EAAa,GACZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CAEb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,SAAmB,IAAT,EACV,QAAS,IAAM,EAAQ,EAAO,GAC9B,UAAU,wDACX,SAID,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,sBAAY,QACpB,EAAK,OAAK,KAGlB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,SAAU,IAAS,EACnB,QAAS,IAAM,EAAQ,EAAO,GAC9B,UAAU,wDACX,gBASb"}