{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking-git/email-tracking/lib/sanity.ts"],"sourcesContent":["import { createClient } from \"@sanity/client\";\n\nexport const sanity = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!,\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || \"production\",\n  apiVersion: \"2024-01-01\",\n  // token: process.env.SANITY_API_TOKEN,\n  token: process.env.SANITY_API_WRITE_TOKEN,\n  useCdn: false,\n});\n\n// async function deleteAllEmails() {\n//   try {\n//     // GROQ query to fetch all email _id's\n//     const emails = await sanity.fetch(`*[_type == \"emails\"]{_id}`);\n\n//     // Delete all emails\n//     const deletePromises = emails.map((email: { _id: any; }) => sanity.delete(email._id));\n//     await Promise.all(deletePromises);\n\n//     console.log('All emails deleted successfully!');\n//   } catch (err) {\n//     console.error('Error deleting emails:', err);\n//   }\n// }\n\n// deleteAllEmails();\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,SAAS,IAAA,gMAAY,EAAC;IACjC,SAAS;IACT,SAAS,kDAA0C;IACnD,YAAY;IACZ,uCAAuC;IACvC,OAAO,QAAQ,GAAG,CAAC,sBAAsB;IACzC,QAAQ;AACV,IAEA,qCAAqC;CACrC,UAAU;CACV,6CAA6C;CAC7C,sEAAsE;CAEtE,2BAA2B;CAC3B,6FAA6F;CAC7F,yCAAyC;CAEzC,uDAAuD;CACvD,oBAAoB;CACpB,oDAAoD;CACpD,MAAM;CACN,IAAI;CAEJ,qBAAqB"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking-git/email-tracking/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport { sanity } from \"@/lib/sanity\";\n\nexport async function POST(req: Request) {\n  try {\n    const { identifier, password } = await req.json();\n\n    if (!identifier || !password) {\n      return NextResponse.json(\n        { success: false, message: \"Missing credentials\" },\n        { status: 400 }\n      );\n    }\n\n    const idValue = identifier.trim();\n    const isEmail = idValue.includes(\"@\");\n\n    // Fetch user safely\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let user: any;\n    if (isEmail) {\n      user = await sanity.fetch(\n        `*[_type == \"user\" && email == $email][0]`,\n        { email: idValue.toLowerCase() } // normalize email\n      );\n    } else {\n      const numericId = Number(idValue);\n      if (isNaN(numericId)) {\n        return NextResponse.json(\n          { success: false, message: \"Invalid userId\" },\n          { status: 400 }\n        );\n      }\n      user = await sanity.fetch(\n        `*[_type == \"user\" && userId == $userId][0]`,\n        { userId: numericId }\n      );\n    }\n\n    console.log(\"LOGIN USER:\", user);\n\n    if (!user || !user.password) {\n      // If no user or password field missing\n      return NextResponse.json(\n        { success: false, message: \"User not found or invalid user data\" },\n        { status: 404 }\n      );\n    }\n\n    // Compare password\n    const isValid = await bcrypt.compare(password, user.password);\n\n    if (!isValid) {\n      return NextResponse.json(\n        { success: false, message: \"Invalid password\" },\n        { status: 401 }\n      );\n    }\n\n    const token = jwt.sign(\n      { userId: user._id, email: user.email },\n      process.env.JWT_SECRET!,\n      { expiresIn: \"1d\" }\n    );\n\n    return NextResponse.json({\n      success: true,\n      token,\n      user: {\n        id: user._id,\n        email: user.email,\n        userId: user.userId,\n      },\n    });\n  } catch (error) {\n    console.error(\"LOGIN ERROR:\", error);\n    return NextResponse.json(\n      { success: false, message: \"Server error\" },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAE/C,IAAI,CAAC,cAAc,CAAC,UAAU;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAsB,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,WAAW,IAAI;QAC/B,MAAM,UAAU,QAAQ,QAAQ,CAAC;QAEjC,oBAAoB;QACpB,8DAA8D;QAC9D,IAAI;QACJ,IAAI,SAAS;YACX,OAAO,MAAM,yHAAM,CAAC,KAAK,CACvB,CAAC,wCAAwC,CAAC,EAC1C;gBAAE,OAAO,QAAQ,WAAW;YAAG,EAAE,kBAAkB;;QAEvD,OAAO;YACL,MAAM,YAAY,OAAO;YACzB,IAAI,MAAM,YAAY;gBACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,SAAS;gBAAiB,GAC5C;oBAAE,QAAQ;gBAAI;YAElB;YACA,OAAO,MAAM,yHAAM,CAAC,KAAK,CACvB,CAAC,0CAA0C,CAAC,EAC5C;gBAAE,QAAQ;YAAU;QAExB;QAEA,QAAQ,GAAG,CAAC,eAAe;QAE3B,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;YAC3B,uCAAuC;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAsC,GACjE;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QAE5D,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAmB,GAC9C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,kJAAG,CAAC,IAAI,CACpB;YAAE,QAAQ,KAAK,GAAG;YAAE,OAAO,KAAK,KAAK;QAAC,GACtC,QAAQ,GAAG,CAAC,UAAU,EACtB;YAAE,WAAW;QAAK;QAGpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,MAAM;gBACJ,IAAI,KAAK,GAAG;gBACZ,OAAO,KAAK,KAAK;gBACjB,QAAQ,KAAK,MAAM;YACrB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAe,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}