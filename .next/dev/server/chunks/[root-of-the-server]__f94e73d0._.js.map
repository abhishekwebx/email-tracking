{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking%20sainty/email-tracking-next/lib/sanity.ts"],"sourcesContent":["import { createClient } from \"@sanity/client\";\n\n// export const sanity = createClient({\n//   projectId: 'lgzekbmp',\n//   dataset: \"production\",\n//   apiVersion: \"2024-01-01\",\n//   useCdn: false,\n//   token: 'sk8SI0h8a7NRypPIhe36dNQhZJWuS0Do22aKeFwLo4EKbUl9ihHeI3zhXyP9OKkZCDIZ6C2jkCXFcc9t8DMctKvF7jHqghh0Nu1NsP1LeT87OAyKhGGzWyRvidBu4GGpBRXRnHWECSQy3P28l5S6Io56kzHIXtahUCH9eT7mT9Ew7SzIxujV',\n// });\n\n\n\nexport const sanity = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!,\n  dataset: 'production',\n  apiVersion: '2024-01-01',\n  token: process.env.SANITY_API_TOKEN,\n  useCdn: false,\n})\n"],"names":[],"mappings":";;;;AAAA;;AAYO,MAAM,SAAS,IAAA,oQAAY,EAAC;IACjC,SAAS;IACT,SAAS;IACT,YAAY;IACZ,OAAO,QAAQ,GAAG,CAAC,gBAAgB;IACnC,QAAQ;AACV"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking%20sainty/email-tracking-next/app/api/draft/route.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-require-imports */\nimport { NextApiRequest, NextApiResponse } from \"next\";\nimport { sanity } from \"@/lib/sanity\";\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  try {\n    if (req.method !== \"POST\") {\n      return res.status(405).json({ error: \"Method not allowed\" });\n    }\n\n    const authHeader = req.headers.authorization;\n    if (!authHeader) return res.status(401).json({ error: \"Unauthorized\" });\n\n    const token = authHeader.replace(\"Bearer \", \"\");\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const decoded: any = require(\"jsonwebtoken\").verify(token, process.env.JWT_SECRET!);\n\n    const { id: draftId, to, subject, body, senderName } = req.body;\n\n    if (!to || !subject || !body) {\n      return res.status(400).json({ error: \"Missing fields\" });\n    }\n\n    let emailDoc;\n\n    if (draftId) {\n      // ✅ Update existing draft\n      emailDoc = await sanity\n        .patch(draftId)\n        .set({\n          to,\n          subject,\n          body,\n          senderName,\n          updatedAt: new Date().toISOString(),\n          status: \"draft\", // keep as draft\n        })\n        .commit();\n    } else {\n      // ✅ Create new draft\n      emailDoc = await sanity.create({\n        _type: \"emails\",\n        user: { _type: \"reference\", _ref: decoded.userId },\n        to,\n        subject,\n        body,\n        senderName,\n        status: \"draft\",\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n        openCount: 0,\n        clickCount: 0,\n      });\n    }\n\n    return res.status(200).json(emailDoc);\n  } catch (err: any) {\n    console.error(\"Draft API error:\", err);\n    return res.status(500).json({ error: err.message });\n  }\n}\n"],"names":[],"mappings":"AAAA,wDAAwD;;;;AAExD;;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI;QACF,IAAI,IAAI,MAAM,KAAK,QAAQ;YACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAqB;QAC5D;QAEA,MAAM,aAAa,IAAI,OAAO,CAAC,aAAa;QAC5C,IAAI,CAAC,YAAY,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAe;QAErE,MAAM,QAAQ,WAAW,OAAO,CAAC,WAAW;QAC5C,8DAA8D;QAC9D,MAAM,UAAe,kJAAwB,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;QAEjF,MAAM,EAAE,IAAI,OAAO,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,GAAG,IAAI,IAAI;QAE/D,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM;YAC5B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAiB;QACxD;QAEA,IAAI;QAEJ,IAAI,SAAS;YACX,0BAA0B;YAC1B,WAAW,MAAM,6LAAM,CACpB,KAAK,CAAC,SACN,GAAG,CAAC;gBACH;gBACA;gBACA;gBACA;gBACA,WAAW,IAAI,OAAO,WAAW;gBACjC,QAAQ;YACV,GACC,MAAM;QACX,OAAO;YACL,qBAAqB;YACrB,WAAW,MAAM,6LAAM,CAAC,MAAM,CAAC;gBAC7B,OAAO;gBACP,MAAM;oBAAE,OAAO;oBAAa,MAAM,QAAQ,MAAM;gBAAC;gBACjD;gBACA;gBACA;gBACA;gBACA,QAAQ;gBACR,WAAW,IAAI,OAAO,WAAW;gBACjC,WAAW,IAAI,OAAO,WAAW;gBACjC,WAAW;gBACX,YAAY;YACd;QACF;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAC9B,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO;QAAC;IACnD;AACF"}}]
}