{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking-git/email-tracking/lib/sanity.ts"],"sourcesContent":["import { createClient } from \"@sanity/client\";\n\nexport const sanity = createClient({\n  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!,\n  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET || \"production\",\n  apiVersion: \"2024-01-01\",\n  // token: process.env.SANITY_API_TOKEN,\n  token: process.env.SANITY_API_WRITE_TOKEN,\n  useCdn: false,\n});\n\n// async function deleteAllEmails() {\n//   try {\n//     // GROQ query to fetch all email _id's\n//     const emails = await sanity.fetch(`*[_type == \"emails\"]{_id}`);\n\n//     // Delete all emails\n//     const deletePromises = emails.map((email: { _id: any; }) => sanity.delete(email._id));\n//     await Promise.all(deletePromises);\n\n//     console.log('All emails deleted successfully!');\n//   } catch (err) {\n//     console.error('Error deleting emails:', err);\n//   }\n// }\n\n// deleteAllEmails();\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,SAAS,IAAA,gMAAY,EAAC;IACjC,SAAS;IACT,SAAS,kDAA0C;IACnD,YAAY;IACZ,uCAAuC;IACvC,OAAO,QAAQ,GAAG,CAAC,sBAAsB;IACzC,QAAQ;AACV,IAEA,qCAAqC;CACrC,UAAU;CACV,6CAA6C;CAC7C,sEAAsE;CAEtE,2BAA2B;CAC3B,6FAA6F;CAC7F,yCAAyC;CAEzC,uDAAuD;CACvD,oBAAoB;CACpB,oDAAoD;CACpD,MAAM;CACN,IAAI;CAEJ,qBAAqB"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking-git/email-tracking/app/api/emails/route.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\nimport { sanity } from \"@/lib/sanity\";\n\nexport async function GET(req: Request) {\n  const authHeader = req.headers.get(\"authorization\");\n\n  if (!authHeader) {\n    return new Response(\"Unauthorized\", { status: 401 });\n  }\n\n  const token = authHeader.replace(\"Bearer \", \"\");\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let decoded: any;\n\n  try {\n    decoded = jwt.verify(token, process.env.JWT_SECRET!);\n  } catch {\n    return new Response(\"Invalid token\", { status: 401 });\n  }\n\n  const userId = decoded.userId;\n\n  const { searchParams } = new URL(req.url);\n  const filter = searchParams.get(\"filter\");\n\n  const now = new Date();\n\n  const startToday = new Date(now);\n  startToday.setHours(0, 0, 0, 0);\n\n  const startWeek = new Date(now);\n  startWeek.setDate(now.getDate() - now.getDay());\n  startWeek.setHours(0, 0, 0, 0);\n\n  const startLastWeek = new Date(startWeek);\n  startLastWeek.setDate(startWeek.getDate() - 7);\n\n  const startMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n\n  let query = `*[_type == \"emails\" && user._ref == $userId`;\n\n  if (filter === \"today\") {\n    query += ` && sentAt >= $startToday`;\n  }\n\n  if (filter === \"week\") {\n    query += ` && sentAt >= $startWeek`;\n  }\n\n  if (filter === \"last_week\") {\n    query += ` && sentAt >= $startLastWeek && sentAt < $startWeek`;\n  }\n\n  if (filter === \"month\") {\n    query += ` && sentAt >= $startMonth`;\n  }\n\n  query += `] | order(sentAt desc)`;\n\n  const emails = await sanity.fetch(query, {\n    userId,\n    startToday: startToday.toISOString(),\n    startWeek: startWeek.toISOString(),\n    startLastWeek: startLastWeek.toISOString(),\n    startMonth: startMonth.toISOString(),\n  });\n\n  return Response.json(emails);\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,GAAY;IACpC,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;IAEnC,IAAI,CAAC,YAAY;QACf,OAAO,IAAI,SAAS,gBAAgB;YAAE,QAAQ;QAAI;IACpD;IAEA,MAAM,QAAQ,WAAW,OAAO,CAAC,WAAW;IAE5C,8DAA8D;IAC9D,IAAI;IAEJ,IAAI;QACF,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACpD,EAAE,OAAM;QACN,OAAO,IAAI,SAAS,iBAAiB;YAAE,QAAQ;QAAI;IACrD;IAEA,MAAM,SAAS,QAAQ,MAAM;IAE7B,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,SAAS,aAAa,GAAG,CAAC;IAEhC,MAAM,MAAM,IAAI;IAEhB,MAAM,aAAa,IAAI,KAAK;IAC5B,WAAW,QAAQ,CAAC,GAAG,GAAG,GAAG;IAE7B,MAAM,YAAY,IAAI,KAAK;IAC3B,UAAU,OAAO,CAAC,IAAI,OAAO,KAAK,IAAI,MAAM;IAC5C,UAAU,QAAQ,CAAC,GAAG,GAAG,GAAG;IAE5B,MAAM,gBAAgB,IAAI,KAAK;IAC/B,cAAc,OAAO,CAAC,UAAU,OAAO,KAAK;IAE5C,MAAM,aAAa,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,IAAI;IAE/D,IAAI,QAAQ,CAAC,2CAA2C,CAAC;IAEzD,IAAI,WAAW,SAAS;QACtB,SAAS,CAAC,yBAAyB,CAAC;IACtC;IAEA,IAAI,WAAW,QAAQ;QACrB,SAAS,CAAC,wBAAwB,CAAC;IACrC;IAEA,IAAI,WAAW,aAAa;QAC1B,SAAS,CAAC,mDAAmD,CAAC;IAChE;IAEA,IAAI,WAAW,SAAS;QACtB,SAAS,CAAC,yBAAyB,CAAC;IACtC;IAEA,SAAS,CAAC,sBAAsB,CAAC;IAEjC,MAAM,SAAS,MAAM,yHAAM,CAAC,KAAK,CAAC,OAAO;QACvC;QACA,YAAY,WAAW,WAAW;QAClC,WAAW,UAAU,WAAW;QAChC,eAAe,cAAc,WAAW;QACxC,YAAY,WAAW,WAAW;IACpC;IAEA,OAAO,SAAS,IAAI,CAAC;AACvB"}}]
}