{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking%20sainty/email-tracking-next/app/crm/send/advanceEmailEditor.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect } from \"react\";\n\ninterface Props {\n  body: string;\n  setBody: (val: string) => void;\n}\n\nexport default function AdvanceEmailBuilder({ body, setBody }: Props) {\n  const editor = useEditor({\n    extensions: [StarterKit],\n    content: body,\n    immediatelyRender: false,\n    onUpdate: ({ editor }) => {\n      setBody(editor.getHTML());\n    },\n  });\n\n  // ðŸ”¥ FIX EDIT MODE SYNC\n  useEffect(() => {\n    if (editor && body !== editor.getHTML()) {\n      editor.commands.setContent(body || \"\");\n    }\n  }, [body, editor]);\n\n  if (!editor) return null;\n\n  return <EditorContent editor={editor} />;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAWe,SAAS,oBAAoB,EAAE,IAAI,EAAE,OAAO,EAAS;;IAClE,MAAM,SAAS,IAAA,sPAAS,EAAC;QACvB,YAAY;YAAC,6OAAU;SAAC;QACxB,SAAS;QACT,mBAAmB;QACnB,QAAQ;qDAAE,CAAC,EAAE,MAAM,EAAE;gBACnB,QAAQ,OAAO,OAAO;YACxB;;IACF;IAEA,wBAAwB;IACxB,IAAA,8OAAS;yCAAC;YACR,IAAI,UAAU,SAAS,OAAO,OAAO,IAAI;gBACvC,OAAO,QAAQ,CAAC,UAAU,CAAC,QAAQ;YACrC;QACF;wCAAG;QAAC;QAAM;KAAO;IAEjB,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBAAO,iQAAC,0PAAa;QAAC,QAAQ;;;;;;AAChC;GApBwB;;QACP,sPAAS;;;KADF"}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking%20sainty/email-tracking-next/app/crm/send/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport \"./send-email.css\";\nimport AuthGuard from \"@/components/AuthGuard\";\nimport AdvanceEmailBuilder from \"./advanceEmailEditor\";\n\ninterface SendEmailProps {\n  emailId?: string;\n}\n\nexport default function SendEmail({ emailId }: SendEmailProps) {\n  //  Multiple Emails State\n  const [to, setTo] = useState<string[]>([]);\n  const [inputValue, setInputValue] = useState(\"\");\n\n  const [subject, setSubject] = useState(\"\");\n  const [body, setBody] = useState(\"\");\n  const [senderName, setSenderName] = useState(\"\");\n\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n\n  useEffect(() => {\n    if (!emailId) return;\n\n    const loadDraft = async () => {\n      try {\n        const res = await fetch(`/api/emails/${emailId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n      });\n        const data = await res.json();\n\n        if (!res.ok) throw new Error(data.error);\n\n        setTo([data.to || \"\"]);\n        setSubject(data.subject || \"\");\n        setBody(data.body || \"\");\n        setSenderName(data.senderName || \"\");\n        setDraftId(data._id);\n      } catch (err) {\n        console.error(\"Draft load error\", err);\n      }\n    };\n\n    loadDraft();\n  }, [emailId]);\n\n  //  Email validation\n  const isValidEmail = (email: string) =>\n    /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n\n  //  Add email chip\n  const addEmail = (email: string) => {\n    email = email.trim();\n\n    if (!isValidEmail(email)) {\n      setError(\"Invalid email format\");\n      return;\n    }\n\n    if (!to.includes(email)) {\n      setTo([email, ...to]); // Add on top\n    }\n\n    setInputValue(\"\");\n    setError(null);\n  };\n\n  //  Enter key support\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && inputValue.trim()) {\n      e.preventDefault();\n      addEmail(inputValue);\n    }\n  };\n\n  //  Remove email chip\n  const removeEmail = (email: string) => {\n    setTo(to.filter((e) => e !== email));\n  };\n\n  //  Paste multiple emails support\n  const handlePaste = (e: React.ClipboardEvent<HTMLInputElement>) => {\n    const paste = e.clipboardData.getData(\"text\");\n    const emails = paste.split(/[,;\\s]+/);\n\n    emails.forEach((email) => {\n      if (isValidEmail(email) && !to.includes(email)) {\n        setTo((prev) => [email, ...prev]);\n      }\n    });\n\n    e.preventDefault();\n  };\n\n  // Load logged user\n  useEffect(() => {\n    const user = JSON.parse(localStorage.getItem(\"user\") || \"{}\");\n    setSenderName(user?.email || \"\");\n  }, []);\n\n  //  SEND EMAIL\n  const sendEmail = async () => {\n    setError(null);\n    setSuccess(false);\n\n    if (to.length === 0 || !subject || !body) {\n      setError(\"All fields are required\");\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const res = await fetch(\"/api/send\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n        body: JSON.stringify({\n          to,\n          subject,\n          body,\n          senderName,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) throw new Error(data.error);\n\n      setSuccess(true);\n      setTo([]);\n      setSubject(\"\");\n      setBody(\"\");\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      setError(err.message || \"Failed to send email\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const [draftId, setDraftId] = useState<string | null>(emailId || null);\n\n  const saveAsDraft = async () => {\n    setLoading(true);\n\n    try {\n      const res = await fetch(\"/api/draft\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n        body: JSON.stringify({\n          id: draftId,\n          to,\n          subject,\n          body,\n          senderName,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) throw new Error(data.error);\n\n      if (!draftId) setDraftId(data._id);\n\n      setSuccess(true);\n      setTo([]);\n      setSubject(\"\");\n      setBody(\"\");\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isFormValid = () => {\n    return to.length > 0 && subject.trim() !== \"\" && body.trim() !== \"\";\n  };\n\n  return (\n    <AuthGuard>\n      <div className=\"container\">\n        <div className=\"card\">\n          <h1>Send Email</h1>\n          <p className=\"subtitle\">Track opens in real-time</p>\n\n          {error && <div className=\"error\">{error}</div>}\n          {success && <div className=\"success\">Email sent successfully!</div>}\n\n          {/* MULTI EMAIL INPUT */}\n          <label>To</label>\n\n          <div className=\"email-wrapper\">\n            {to.map((email) => (\n              <span key={email} className=\"chip\">\n                {email}\n                <button onClick={() => removeEmail(email)}>Ã—</button>\n              </span>\n            ))}\n\n            <input\n              type=\"email\"\n              placeholder=\"Type email & press Enter\"\n              value={inputValue}\n              onChange={(e) => setInputValue(e.target.value)}\n              onKeyDown={handleKeyDown}\n              onPaste={handlePaste}\n            />\n          </div>\n\n          {/* SUBJECT */}\n          <label>Subject</label>\n          <input\n            value={subject}\n            placeholder=\"Enter subject\"\n            onChange={(e) => setSubject(e.target.value)}\n          />\n\n          {/* EMAIL BUILDER */}\n          <label>Message</label>\n          {/* <EmailBuilder body={body} setBody={setBody} /> */}\n          <AdvanceEmailBuilder body={body} setBody={setBody} />\n\n          <button\n            className=\"send-button ml-2\"\n            disabled={loading || !to.length}\n            onClick={saveAsDraft}\n          >\n            {loading ? \"Save...\" : \"Save Email as Draft\"}\n          </button>\n\n          {/* SEND BUTTON */}\n          <button\n            className=\"send-button\"\n            disabled={loading || !isFormValid()}\n            onClick={sendEmail}\n          >\n            {loading ? \"Sending...\" : \"Send Email\"}\n          </button>\n        </div>\n      </div>\n    </AuthGuard>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}