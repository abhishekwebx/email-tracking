{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/hp/Desktop/email-traking%20sainty/email-tracking-next/app/crm/templates/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport Swal from \"sweetalert2\";\n\nexport default function TemplatesList() {\n  const [templates, setTemplates] = useState<any[]>([]);\n  const [search, setSearch] = useState(\"\");\n  const [page, setPage] = useState(1);\n  const [total, setTotal] = useState(0);\n\n  const limit = 9;\n  const router = useRouter();\n\n  /* --------------------------------------------\n     LOAD TEMPLATES\n  -------------------------------------------- */\n  const loadTemplates = async () => {\n    try {\n      const res = await fetch(\n        `/api/templates?search=${search}&page=${page}&limit=${limit}`\n      );\n\n      const data = await res.json();\n\n      // âœ… FIXED RESPONSE KEY\n      setTemplates(Array.isArray(data.data) ? data.data : []);\n      setTotal(data.total || 0);\n\n    } catch (err) {\n      console.error(\"Template load error\", err);\n      setTemplates([]);\n    }\n  };\n\n  useEffect(() => {\n    loadTemplates();\n  }, [search, page]);\n\n  /* --------------------------------------------\n     DELETE TEMPLATE\n  -------------------------------------------- */\n  const deleteTemplate = async (id: string) => {\n    const result = await Swal.fire({\n      title: \"Delete Template?\",\n      text: \"This action cannot be undone.\",\n      icon: \"warning\",\n      showCancelButton: true,\n      confirmButtonColor: \"#d33\",\n      cancelButtonColor: \"#3085d6\",\n      confirmButtonText: \"Yes, delete it!\",\n    });\n\n    if (!result.isConfirmed) return;\n\n    try {\n      await fetch(`/api/templates/${id}`, {\n        method: \"DELETE\",\n      });\n\n      setTemplates((prev) => prev.filter((t) => t._id !== id));\n\n      Swal.fire(\"Deleted!\", \"Template deleted.\", \"success\");\n\n    } catch {\n      Swal.fire(\"Error\", \"Failed to delete template\", \"error\");\n    }\n  };\n\n  const totalPages = Math.ceil(total / limit);\n\n  /* --------------------------------------------\n     UI\n  -------------------------------------------- */\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n\n        {/* Header */}\n        <div className=\"flex justify-between items-center mb-6\">\n          <h1 className=\"text-2xl font-semibold text-gray-800\">\n            Email Templates\n          </h1>\n\n          <button\n            onClick={() => router.push(\"/crm/templates/create\")}\n            className=\"bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 cursor-pointer\"\n          >\n            + Create Template\n          </button>\n        </div>\n\n        {/* Search */}\n        <div className=\"mb-6\">\n          <input\n            type=\"text\"\n            placeholder=\"Search templates...\"\n            value={search}\n            onChange={(e) => {\n              setSearch(e.target.value);\n              setPage(1);\n            }}\n            className=\"w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        {/* Template Grid */}\n        {templates.length === 0 ? (\n          <div className=\"bg-white p-10 rounded-xl shadow text-center\">\n            No templates found\n          </div>\n        ) : (\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {templates.map((t) => (\n              <div\n                key={t._id}\n                className=\"bg-indigo-50 rounded-xl shadow p-5 flex flex-col justify-between\"\n              >\n                <div>\n                  <h2 className=\"text-lg font-semibold text-indigo-700 mb-2\">\n                    {t.title}\n                  </h2>\n\n                  {t.category && (\n                    <span className=\"bg-blue-100 text-blue-700 text-xs px-3 py-1 rounded-full mb-3 inline-block\">\n                      {t.category}\n                    </span>\n                  )}\n\n                  <p className=\"text-sm text-gray-500 line-clamp-2\">\n                    {t.subject || \"No subject\"}\n                  </p>\n                </div>\n\n                {/* Actions */}\n                <div className=\"flex justify-between items-center mt-5\">\n\n                  <div className=\"flex gap-3\">\n                    <button\n                      onClick={() =>\n                        router.push(`/crm/templates/create?id=${t._id}`)\n                      }\n                      className=\"text-sm text-blue-600 border border-blue-600 px-3 py-1 rounded hover:bg-blue-600 hover:text-white transition cursor-pointer\"\n                    >\n                      Edit\n                    </button>\n\n                    <button\n                      onClick={() => deleteTemplate(t._id)}\n                      className=\"text-sm text-red-600 border border-red-600 px-3 py-1 rounded hover:bg-red-600 hover:text-white transition cursor-pointer\"\n                    >\n                      Delete\n                    </button>\n                  </div>\n\n                  <button\n                    onClick={() =>\n                      router.push(`/crm/send?template=${t._id}`)\n                    }\n                    className=\"bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-sm cursor-pointer\"\n                  >\n                    Use In\n                  </button>\n\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"flex justify-center mt-8 gap-4\">\n\n            <button\n              disabled={page === 1}\n              onClick={() => setPage(page - 1)}\n              className=\"px-4 py-2 border rounded disabled:opacity-40\"\n            >\n              Prev\n            </button>\n\n            <span className=\"px-4 py-2\">\n              Page {page} of {totalPages}\n            </span>\n\n            <button\n              disabled={page === totalPages}\n              onClick={() => setPage(page + 1)}\n              className=\"px-4 py-2 border rounded disabled:opacity-40\"\n            >\n              Next\n            </button>\n\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}